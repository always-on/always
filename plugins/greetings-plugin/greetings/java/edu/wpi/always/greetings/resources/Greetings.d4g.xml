<?xml version="1.0" encoding="utf-8"?>
<model about="urn:always.wpi.edu:models:Greetings" 
       xmlns="http://www.cs.wpi.edu/~rich/d4g" 
       xmlns:t="http://www.cs.wpi.edu/~rich/cetask/cea-2018-ext">

<!--  <t:script init="true">
    var hour = Packages.org.joda.time.LocalTime.now().getHourOfDay();
  </t:script>
-->
 <t:script init="true"> 
    var user = $always.getUserModel().getPeopleManager().getUser();
    var userName = $always.getUserModel().getUserFirstName();
    print ("the user's name is =" + userName + "  ");
  var poorSleepreports= 0;
 </t:script>

<t:task id="_FirstThingStrangerAcq">
  <t:subtasks id="simple">
      <t:step name="greet" task="_Greetings"/>
      <t:step name="sleep" task="_SleepWellSA"/>
  </t:subtasks>
</t:task>

<t:task id="_FirstThingCompanion">
  <t:subtasks id="base">
      <t:step name="greet" task="_Greetings"/>
      <t:step name="sleep" task="_SleepWellC"/>
  </t:subtasks>
</t:task>

<agent id="_Greetings" text="Good morning, {userName}.">
  <user text="Good morning."/>
  <user text="oh morning already!  Good morning!"/>
</agent>

 <agent id="_SleepWellSA" text="Did you sleep well?">
    <user id="affirm" text="yes">
      <agent text="Are you feeling okay today?">
	<user text="yes">
	  <agent text="good, glad to hear it"/>
	</user>
	<user text="no but it's nothing.">
	  <agent text="glad to hear it."/>
	</user>
	<user text="no">
	  <do task="_CallDoc" />
	</user>
      </agent>
    </user>
    <user id="neg" text="No">
      <agent id="feeling" text="oh, are you feeling sick?">
	<!-- set poorSleep in UM to 1+ poorSleepreports -->
	<user text="no">
	  <agent text="I hope you sleep better tonight" />
	</user>
	<user text="yes"> 
	  <do task="_CallDoc" />
	</user>
      </agent>
    </user>
 </agent>

<agent id="_CallDoc" text="do you think you should call your doctor?">
  <user text="yes">
    <agent text="ok, so do that sometime today">
      <user text="ok"/> 
      <user text="no, I'll call the doc later if I still don't feel good.">
	<agent text="okay"/>  
      </user>
    </agent>
  </user>
  <user text="no">
    <agent text="well, you know best.  I'm sorry you aren't feeling so good."/>
  </user>
</agent>

 <agent id="_SleepWellC" text="Did you sleep well?">
    <user id="yup" text="yes">
      <agent text="Are you feeling okay?">
	<user text="yes">
	  <agent text="good"/>
	</user>
	<user text="no but it's nothing.">
	  <agent text="glad to hear it."/>
	</user>
	<user text="No I don't feel so great">
	  <do task="_CallDoc" />
	</user>
      </agent>
    </user>
    <user text="no"> <!-- note "poorSleep" in user model -->
      <agent 
	  text="Oh, you aren't sleeping well.  Maybe you should consult your doctor" 
	  applicable="poorSleepreports &gt; 7" >
	<!-- set poorSleep in UM to 1+ poorSleepreports -->
	<user text="yes, I will next time I go to the doctor"/>
	<user text="no I am just not a good sleeper" />
	<user text="oh, it's not anything" >
	  <agent text="well, the doctor won't mind if you ask.">
	    <user text="okay"/>
	    <user text="maybe later" />
	  </agent>
	</user>
      </agent>
      <agent 
	    text="Gee, that's rare for you.  Are you feeling okay?"
	    applicable="poorSleepreports &lt; 7">
	<!-- set poorSleep in UM to 1+ poorSleepreports -->
	<user text="yes" >
	  <agent text="good!"/>
	</user>
	<user text="no, but it's nothing.">
	  <agent text="okay"/> 
	</user>
	<user text="no, not so much" >
	  <agent text="mm, maybe you should give the doc's office a call later today." >
	    <user text="yeh, I think I will.">
	      <agent text="okay."/> 
	    </user>
	    <user  text="No, I'll be okay." >
	      <agent text="okay, your call.  Pun intended!"/>
	    </user>
	  </agent>
	</user>
      </agent>
    </user>
 </agent>

  <agent id="_AfternoonGreetings" text="How's your day going?">
    <user id="affirmAfternoon" text="fine">  
      <agent text="good, glad to hear it"/>
    </user>
    <user text="oh not so great">
      <agent text="sorry to hear it. Maybe it will improve">
	<user text="hope so" />
	<user text="it has to!" />
	<user text="we'll see" />
      </agent>
    </user>
  </agent>
  
  <agent id="_EveningGreetings" text="So had a good day?">
    <user id="affirmEvening" text="yes, a good one">  
      <agent text="good, glad to hear it"/>
    </user>
    <user text="no, not really">
      <agent text="sorry to hear it. Maybe this evening will be better">
	<user text="Hope so" />
	<user text="Maybe" />
	<user text="We'll see" />
      </agent>
    </user>
    <user text="nothing special">
      <agent text="Some days are like that. There's still the evening to come!">
	<user text="Yes, so there is"/>
	<user text="Not expecting much" />
	<user text="I'm looking forward to it" />
      </agent>
    </user>
  </agent>

  <agent id="_GoodNight" text="Guess it's time to say goodnight">
    <user id="affirmGoodNight" text="Yes, good night">  
      <agent text="Thanks, sleep well."/>
    </user>
    <user text="No yet.  I got things to do.">
      <agent text="Well, okay, sleep well when you get there">
	<user text="Good night">
	  <agent text="Good night!" />
	</user>
	<user text="Will do. Good night" >
	  <agent text="Good night!" />
	</user>
	<user text="Hope so. Good night" >
	  <agent text="Good night!" />
	</user>
	<user text="Good night" >
	  <agent text="Good night!" />
	</user>
      </agent>
    </user>
    <user text="No.  I plan to read a bit yet">
      <agent text="Oh, well good night for later!">
	<user text="Thanks, Good night"/>
	<user text="Sleep well">
	  <agent text="You know, I don't really go to sleep.  But good night" />
	</user>
	<user text="I'm hoping for a good night's rest in a bit." >
	  <agent text="Good night"/>
	</user>
      </agent>
    </user>
  </agent>

</model>
