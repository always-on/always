<?xml version="1.0" encoding="UTF-8"?>
<taskModel xmlns="http://www.cs.wpi.edu/~rich/cetask/cea-2018-ext"
           xmlns:disco="urn:disco.wpi.edu:Disco"
           about="urn:always.wpi.edu:models:Explain">
   <task id="_StartRest">
      <subtasks id="__StartRest_subtasks">
         <step name="__StartRest_step" task="disco:Say"/>
         <step name="__StartRest_ref" task="__StartRest_tree"/>
         <binding slot="$__StartRest_step.text"
                  value="&#34;I have told you about some of the activities we can do together.  There are a few more.  Want to hear about them?&#34;"/>
         <binding slot="$__StartRest_step.external" value="false"/>
      </subtasks>
   </task>
   <task id="MoreExplaining">
      <subtasks id="_MoreExplaining_subtasks">
         <step name="_MoreExplaining_step" task="_SetChoiceActivity"/>
         <step name="_MoreExplaining_ref" task="_MoreExplaining_tree"/>
         <binding slot="$_MoreExplaining_step.external" value="false"/>
      </subtasks>
   </task>
   <task id="_EndExplaining">
      <subtasks id="__EndExplaining_subtasks">
         <step name="__EndExplaining_step" task="disco:Say"/>
         <step name="__EndExplaining_ref" task="__EndExplaining_tree"/>
         <binding slot="$__EndExplaining_step.text"
                  value="&#34;Well, anytime you want more explanations, just ask!&#34;"/>
         <binding slot="$__EndExplaining_step.external" value="false"/>
      </subtasks>
   </task>
   <task id="_ExplainPlayRummy">
      <subtasks id="__ExplainPlayRummy_subtasks">
         <step name="__ExplainPlayRummy_step" task="disco:Say$Eval"/>
         <step name="__ExplainPlayRummy_ref" task="__ExplainPlayRummy_tree"/>
         <binding slot="$__ExplainPlayRummy_step.text"
                  value="&#34;We can play cards together.  In particular we can play rummy.  Other computers can play cards, but they just make the moves, and then give you a turn.  When we play cards, we can talk about our hands and anything else you want while we play the game.&#34;"/>
         <binding slot="$__ExplainPlayRummy_step.external" value="false"/>
         <binding slot="$__ExplainPlayRummy_step.eval" value="&#34;Activity.ALL.PlayRummy.setFlag()&#34;"/>
      </subtasks>
   </task>
   <task id="_ExplainUseCalendar">
      <subtasks id="__ExplainUseCalendar_subtasks">
         <step name="__ExplainUseCalendar_step" task="disco:Say"/>
         <step name="__ExplainUseCalendar_ref" task="__ExplainUseCalendar_tree"/>
         <binding slot="$__ExplainUseCalendar_step.text"
                  value="&#34;I can keep track of your everyday calendar.  That means I can tell you what day and time you want to meet someone, go out to dinner with a friend, go to an apppointment, or remember something important.&#34;"/>
         <binding slot="$__ExplainUseCalendar_step.external" value="false"/>
      </subtasks>
   </task>
   <task id="_ExplainDiscussWeather">
      <subtasks id="__ExplainDiscussWeather_subtasks">
         <step name="__ExplainDiscussWeather_step" task="disco:Say$Eval"/>
         <step name="__ExplainDiscussWeather_ref" task="__ExplainDiscussWeather_tree"/>
         <binding slot="$__ExplainDiscussWeather_step.text"
                  value="&#34;We've already talked about the weather.  BUT I can do more!  I can get information from the internet about weather just about anywhere&#34;"/>
         <binding slot="$__ExplainDiscussWeather_step.external" value="false"/>
         <binding slot="$__ExplainDiscussWeather_step.eval"
                  value="&#34;Activity.ALL.DiscussWeather.setFlag()&#34;"/>
      </subtasks>
   </task>
   <task id="_ExplainDiscussFamily">
      <subtasks id="__ExplainDiscussFamily_subtasks">
         <step name="__ExplainDiscussFamily_step" task="disco:Say"/>
         <step name="__ExplainDiscussFamily_ref" task="__ExplainDiscussFamily_tree"/>
         <binding slot="$__ExplainDiscussFamily_step.text"
                  value="&#34;I'm interested in knowing about your friends and family.  The more I know about them, the more I can use this information&#34;"/>
         <binding slot="$__ExplainDiscussFamily_step.external" value="false"/>
      </subtasks>
   </task>
   <task id="_ExplainTellStory">
      <subtasks id="__ExplainTellStory_subtasks">
         <step name="__ExplainTellStory_step" task="disco:Say$Eval"/>
         <step name="__ExplainTellStory_ref" task="__ExplainTellStory_tree"/>
         <binding slot="$__ExplainTellStory_step.text"
                  value="&#34;You can tell me a story about your life.  I will pay attention even though I won't understand most of what you say.  When you are done, you can save the story, and if you want, send it out to friends.&#34;"/>
         <binding slot="$__ExplainTellStory_step.external" value="false"/>
         <binding slot="$__ExplainTellStory_step.eval" value="&#34;Activity.ALL.TellStory.setFlag()&#34;"/>
      </subtasks>
   </task>
   <task id="_ExplainPlanExercise">
      <subtasks id="__ExplainPlanExercise_subtasks">
         <step name="__ExplainPlanExercise_step" task="disco:Say"/>
         <step name="__ExplainPlanExercise_ref" task="__ExplainPlanExercise_tree"/>
         <binding slot="$__ExplainPlanExercise_step.text"
                  value="&#34;Everyone can use more exercise.  Walking is a really good and easy type of exercise&#34;"/>
         <binding slot="$__ExplainPlanExercise_step.external" value="false"/>
      </subtasks>
   </task>
   <task id="_MoreExplaining_tree">
      <subtasks id="_d4e30_subtasks">
         <step name="_d4e30_step" task="_ExplainPlanExercise"/>
         <applicable>$CHOICE == Activity.ENUM.PlanExercise</applicable>
      </subtasks>
      <subtasks id="_d4e31_subtasks">
         <step name="_d4e31_step" task="_ExplainDiscussFamily"/>
         <applicable>$CHOICE == Activity.ENUM.DiscussFamily</applicable>
      </subtasks>
      <subtasks id="_d4e32_subtasks">
         <step name="_d4e32_step" task="_ExplainDiscussWeather"/>
         <applicable>$CHOICE == Activity.ENUM.DiscussWeather</applicable>
      </subtasks>
      <subtasks id="_d4e33_subtasks">
         <step name="_d4e33_step" task="_ExplainUseCalendar"/>
         <applicable>$CHOICE == Activity.ENUM.UseCalendar</applicable>
      </subtasks>
      <subtasks id="_d4e34_subtasks">
         <step name="_d4e34_step" task="_ExplainPlayRummy"/>
         <applicable>$CHOICE == Activity.ENUM.PlayRummy</applicable>
      </subtasks>
      <subtasks id="_d4e35_subtasks">
         <step name="_d4e35_step" task="_ExplainTellStory"/>
         <applicable>$CHOICE == Activity.ENUM.TellStory</applicable>
      </subtasks>
   </task>
   <task id="__StartRest_tree">
      <subtasks id="_d4e16_subtasks">
         <step name="_d4e16_step" task="disco:Say"/>
         <binding slot="$_d4e16_step.text" value="&#34;yes, please do.&#34;"/>
         <binding slot="$_d4e16_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e17_subtasks">
         <step name="_d4e17_step" task="disco:Say$Eval"/>
         <binding slot="$_d4e17_step.text" value="&#34;no thanks.&#34;"/>
         <binding slot="$_d4e17_step.external" value="true"/>
         <binding slot="$_d4e17_step.eval" value="&#34;noThanks=true&#34;"/>
      </subtasks>
      <subtasks id="_d4e18_subtasks">
         <step name="_d4e18_step" task="disco:Say$Eval"/>
         <binding slot="$_d4e18_step.text"
                  value="&#34;I would rather hear about all the activities again&#34;"/>
         <binding slot="$_d4e18_step.external" value="true"/>
         <binding slot="$_d4e18_step.eval" value="&#34;Activity.ENUM = Activity.ALL&#34;"/>
      </subtasks>
   </task>
   <task id="__EndExplaining_tree">
      <subtasks id="_d4e41_subtasks">
         <step name="_d4e41_step" task="disco:Say"/>
         <binding slot="$_d4e41_step.text" value="&#34;Ok, thanks&#34;"/>
         <binding slot="$_d4e41_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e42_subtasks">
         <step name="_d4e42_step" task="disco:Say"/>
         <binding slot="$_d4e42_step.text" value="&#34;Thanks that was really interesting!&#34;"/>
         <binding slot="$_d4e42_step.external" value="true"/>
      </subtasks>
   </task>
   <task id="__ExplainPlayRummy_tree">
      <subtasks id="_d4e44_subtasks">
         <step name="_d4e44_step" task="disco:Say"/>
         <binding slot="$_d4e44_step.text" value="&#34;Ok&#34;"/>
         <binding slot="$_d4e44_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e45_subtasks">
         <step name="_d4e45_step" task="disco:Say"/>
         <binding slot="$_d4e45_step.text" value="&#34;oh, that sounds fun!&#34;"/>
         <binding slot="$_d4e45_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e46_subtasks">
         <step name="_d4e46_step" task="disco:Say"/>
         <binding slot="$_d4e46_step.text" value="&#34;I see&#34;"/>
         <binding slot="$_d4e46_step.external" value="true"/>
      </subtasks>
   </task>
   <task id="__ExplainUseCalendar_tree">
      <subtasks id="_d4e48_subtasks">
         <step name="_d4e48_step" task="disco:Say$Eval"/>
         <binding slot="$_d4e48_step.text" value="&#34;Ok&#34;"/>
         <binding slot="$_d4e48_step.external" value="true"/>
         <binding slot="$_d4e48_step.eval" value="&#34;Activity.ALL.UseCalendar.setFlag()&#34;"/>
      </subtasks>
      <subtasks id="_d4e49_subtasks">
         <step name="_d4e49_step" task="disco:Say"/>
         <step name="_d4e50_step" task="disco:Say$Eval"/>
         <step name="_d4e50_ref" task="_d4e50_tree"/>
         <binding slot="$_d4e49_step.text"
                  value="&#34;I don't understand.  How do I tell you what I am doing and when?&#34;"/>
         <binding slot="$_d4e49_step.external" value="true"/>
         <binding slot="$_d4e50_step.text"
                  value="&#34;well, I will ask you about some event you plan to do, like go to the doctor.  After you tell me the day and time, I'll show you the calendar with that event.  You can change it later if you want.&#34;"/>
         <binding slot="$_d4e50_step.external" value="false"/>
         <binding slot="$_d4e50_step.eval" value="&#34;Activity.ALL.UseCalendar.setFlag()&#34;"/>
      </subtasks>
   </task>
   <task id="_d4e50_tree">
      <subtasks id="_d4e51_subtasks">
         <step name="_d4e51_step" task="disco:Say"/>
         <binding slot="$_d4e51_step.text" value="&#34;I see.  That sounds useful.&#34;"/>
         <binding slot="$_d4e51_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e52_subtasks">
         <step name="_d4e52_step" task="disco:Say"/>
         <binding slot="$_d4e52_step.text" value="&#34;okay&#34;"/>
         <binding slot="$_d4e52_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e53_subtasks">
         <step name="_d4e53_step" task="disco:Say"/>
         <step name="_d4e54_step" task="disco:Say"/>
         <step name="_d4e54_ref" task="_d4e54_tree"/>
         <binding slot="$_d4e53_step.text" value="&#34;I still don't understand&#34;"/>
         <binding slot="$_d4e53_step.external" value="true"/>
         <binding slot="$_d4e54_step.text"
                  value="&#34;well, next time just try the calendar activity and you will see how it works&#34;"/>
         <binding slot="$_d4e54_step.external" value="false"/>
      </subtasks>
   </task>
   <task id="_d4e54_tree">
      <subtasks id="_d4e55_subtasks">
         <step name="_d4e55_step" task="disco:Say"/>
         <binding slot="$_d4e55_step.text" value="&#34;okay&#34;"/>
         <binding slot="$_d4e55_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e56_subtasks">
         <step name="_d4e56_step" task="disco:Say"/>
         <binding slot="$_d4e56_step.text" value="&#34;Not sure I will &#34;"/>
         <binding slot="$_d4e56_step.external" value="true"/>
      </subtasks>
   </task>
   <task id="__ExplainDiscussWeather_tree">
      <subtasks id="_d4e58_subtasks">
         <step name="_d4e58_step" task="disco:Say"/>
         <step name="_d4e59_step" task="disco:Say"/>
         <step name="_d4e59_ref" task="_d4e59_tree"/>
         <binding slot="$_d4e58_step.text" value="&#34;Really? Tell me more&#34;"/>
         <binding slot="$_d4e58_step.external" value="true"/>
         <binding slot="$_d4e59_step.text"
                  value="&#34;You can tell me about your family and friends, and I will remember what you say.  You can also tell me if you want to know the weather for that person everyday or just once in a while&#34;"/>
         <binding slot="$_d4e59_step.external" value="false"/>
      </subtasks>
      <subtasks id="_d4e62_subtasks">
         <step name="_d4e62_step" task="disco:Say"/>
         <binding slot="$_d4e62_step.text"
                  value="&#34;I don't really need to know more about the weather &#34;"/>
         <binding slot="$_d4e62_step.external" value="true"/>
      </subtasks>
   </task>
   <task id="_d4e59_tree">
      <subtasks id="_d4e60_subtasks">
         <step name="_d4e60_step" task="disco:Say"/>
         <binding slot="$_d4e60_step.text"
                  value="&#34;Ok, I will tell you about my family an dfriends&#34;"/>
         <binding slot="$_d4e60_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e61_subtasks">
         <step name="_d4e61_step" task="disco:Say"/>
         <binding slot="$_d4e61_step.text" value="&#34;I don't want to know the weather except here&#34;"/>
         <binding slot="$_d4e61_step.external" value="true"/>
      </subtasks>
   </task>
   <task id="__ExplainDiscussFamily_tree">
      <subtasks id="_d4e64_subtasks">
         <step name="_d4e64_step" task="disco:Say"/>
         <step name="_d4e65_step" task="disco:Say$Eval"/>
         <step name="_d4e65_ref" task="_d4e65_tree"/>
         <binding slot="$_d4e64_step.text" value="&#34;uh-huh&#34;"/>
         <binding slot="$_d4e64_step.external" value="true"/>
         <binding slot="$_d4e65_step.text"
                  value="&#34;When I know about your family, I can give you weather information where they live, and I can help you with your calendar.&#34;"/>
         <binding slot="$_d4e65_step.external" value="false"/>
         <binding slot="$_d4e65_step.eval" value="&#34;Activity.ALL.DiscussFamily.setFlag()&#34;"/>
      </subtasks>
   </task>
   <task id="_d4e65_tree">
      <subtasks id="_d4e66_subtasks">
         <step name="_d4e66_step" task="disco:Say"/>
         <binding slot="$_d4e66_step.text" value="&#34;Ok&#34;"/>
         <binding slot="$_d4e66_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e67_subtasks">
         <step name="_d4e67_step" task="disco:Say"/>
         <step name="_d4e68_step" task="disco:Say"/>
         <step name="_d4e68_ref" task="_d4e68_tree"/>
         <binding slot="$_d4e67_step.text" value="&#34;oh, that is good &#34;"/>
         <binding slot="$_d4e67_step.external" value="true"/>
         <binding slot="$_d4e68_step.text"
                  value="&#34;And I can talk to you about your friends and family whenever we chat&#34;"/>
         <binding slot="$_d4e68_step.external" value="false"/>
      </subtasks>
      <subtasks id="_d4e72_subtasks">
         <step name="_d4e72_step" task="disco:Say"/>
         <binding slot="$_d4e72_step.text" value="&#34;I see.  Maybe I'll tell you some time&#34;"/>
         <binding slot="$_d4e72_step.external" value="true"/>
      </subtasks>
   </task>
   <task id="_d4e68_tree">
      <subtasks id="_d4e69_subtasks">
         <step name="_d4e69_step" task="disco:Say"/>
         <step name="_d4e70_step" task="disco:Say"/>
         <binding slot="$_d4e69_step.text" value="&#34;sounds good. &#34;"/>
         <binding slot="$_d4e69_step.external" value="true"/>
         <binding slot="$_d4e70_step.text"
                  value="&#34;I'll remember it for the next time we work together&#34;"/>
         <binding slot="$_d4e70_step.external" value="false"/>
      </subtasks>
      <subtasks id="_d4e71_subtasks">
         <step name="_d4e71_step" task="disco:Say"/>
         <binding slot="$_d4e71_step.text" value="&#34;okay&#34;"/>
         <binding slot="$_d4e71_step.external" value="true"/>
      </subtasks>
   </task>
   <task id="__ExplainTellStory_tree">
      <subtasks id="_d4e75_subtasks">
         <step name="_d4e75_step" task="disco:Say"/>
         <binding slot="$_d4e75_step.text" value="&#34;ok&#34;"/>
         <binding slot="$_d4e75_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e76_subtasks">
         <step name="_d4e76_step" task="disco:Say"/>
         <step name="_d4e77_step" task="disco:Say"/>
         <binding slot="$_d4e76_step.text" value="&#34;I think I will try that.&#34;"/>
         <binding slot="$_d4e76_step.external" value="true"/>
         <binding slot="$_d4e77_step.text" value="&#34;good.  We can do that soon&#34;"/>
         <binding slot="$_d4e77_step.external" value="false"/>
      </subtasks>
      <subtasks id="_d4e78_subtasks">
         <step name="_d4e78_step" task="disco:Say"/>
         <binding slot="$_d4e78_step.text" value="&#34;I see.  Maybe I will do that some time &#34;"/>
         <binding slot="$_d4e78_step.external" value="true"/>
      </subtasks>
   </task>
   <task id="__ExplainPlanExercise_tree">
      <subtasks id="_d4e80_subtasks">
         <step name="_d4e80_step" task="disco:Say"/>
         <step name="_d4e81_step" task="disco:Say$Eval"/>
         <step name="_d4e81_ref" task="_d4e81_tree"/>
         <binding slot="$_d4e80_step.text" value="&#34;uh-huh&#34;"/>
         <binding slot="$_d4e80_step.external" value="true"/>
         <binding slot="$_d4e81_step.text"
                  value="&#34;I can help you work out an exercise plan, including getting a walking buddy.  I can also follow up with you every day once you start walking.&#34;"/>
         <binding slot="$_d4e81_step.external" value="false"/>
         <binding slot="$_d4e81_step.eval" value="&#34;Activity.ALL.PlanExercise.setFlag()&#34;"/>
      </subtasks>
   </task>
   <task id="_d4e81_tree">
      <subtasks id="_d4e82_subtasks">
         <step name="_d4e82_step" task="disco:Say"/>
         <binding slot="$_d4e82_step.text" value="&#34;Ok&#34;"/>
         <binding slot="$_d4e82_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e83_subtasks">
         <step name="_d4e83_step" task="disco:Say"/>
         <step name="_d4e84_step" task="disco:Say"/>
         <step name="_d4e85_step" task="disco:Say"/>
         <binding slot="$_d4e83_step.text" value="&#34;oh, that sounds fun!&#34;"/>
         <binding slot="$_d4e83_step.external" value="true"/>
         <binding slot="$_d4e84_step.text"
                  value="&#34;Good, we can have fun getting you started on exercise&#34;"/>
         <binding slot="$_d4e84_step.external" value="false"/>
         <binding slot="$_d4e85_step.text" value="&#34;Ok&#34;"/>
         <binding slot="$_d4e85_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e86_subtasks">
         <step name="_d4e86_step" task="disco:Say"/>
         <binding slot="$_d4e86_step.text" value="&#34;no thanks&#34;"/>
         <binding slot="$_d4e86_step.external" value="true"/>
      </subtasks>
      <subtasks id="_d4e87_subtasks">
         <step name="_d4e87_step" task="disco:Say"/>
         <binding slot="$_d4e87_step.text" value="&#34;Maybe another time&#34;"/>
         <binding slot="$_d4e87_step.external" value="true"/>
      </subtasks>
   </task>
   <task id="_ExplainSelf">
      <subtasks id="_basic">
         <step name="start" task="MoreExplaining" minOccurs="1" maxOccurs="10"/>
         <step name="end" task="_EndExplaining"/>
         <applicable> !previousTalk </applicable>
      </subtasks>
      <subtasks id="_knowssome">
         <step name="start" task="_StartRest"/>
         <step name="double" task="_Double"/>
         <applicable> previousTalk </applicable>
      </subtasks>
   </task>
   <task id="_Double">
      <subtasks id="_d1">
         <step name="double" task="MoreExplaining" minOccurs="1" maxOccurs="9"/>
         <step name="sameend" task="_EndExplaining"/>
         <applicable> !noThanks </applicable>
      </subtasks>
      <subtasks id="_d2">
         <step name="sameend" task="_EndExplaining"/>
         <applicable> noThanks </applicable>
      </subtasks>
   </task>
   <task id="_SetChoiceActivity">
      <input name="choice" type="Activity"/>
      <script> $CHOICE = $this.choice </script>
   </task>
   <script init="true">

    // defining the Javascript type Activity

    function Activity (flag, format) { 
       this.flag = "Explain"+flag; 
       this.format = format; 
    }

    Activity.prototype.toString = function () {
       return edu.wpi.disco_helper.toString(this.format, Activity, "Activity");
    }

    Activity.prototype.setFlag = function () {
       $always.getUserModel().setProperty(this.flag, true);
    }

    Activity.prototype.checkFlag = function () {
       return $always.getUserModel().isProperty(this.flag);
    }

    // all activities that this plugin knows about 
    // note these correspond to listing in user/Activities.xml
    // (in a fancier implementation, these could be procedurally linked)

    // NB: All flags must be defined in Explain.owl

    Activity.ALL = {
         PlanExercise : new Activity("PlanExercise", "developing an exercise plan for me"), 
         DiscussFamily : new Activity("DiscussFamily", "talking together about my family and friends"),
         UseCalendar : new Activity("UseCalendar", "keeping my personal calendar"),
         PlayRummy : new Activity("PlayRummy", "playing a social game of cards"),
         TellStory : new Activity("TellStory", "telling one of my life stories "),
         DiscussWeather : new Activity("DiscussWeather", "telling weather where my friends and family live")
         // TODO: add the other activities
    }

    // dynamically construct enumeration based on flags

    Activity.ENUM = {}

    for (var a in Activity.ALL) 
      if ( !Activity.ALL[a].checkFlag() ) 
        Activity.ENUM[a] = Activity.ALL[a];

    // dialogue control variables

    var noThanks = false;
    var $CHOICE;

    var previousTalk = $always.getUserModel().isProperty("ExplainPreviousTalk");

  </script>
</taskModel>